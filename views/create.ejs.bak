<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TinyLink — Create</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="app-grid" style="max-width:920px; margin:28px auto;">
    <!-- Reuse smaller sidebar for visual continuity -->
    <aside class="sidebar" style="min-height:160px;padding:16px;">
      <div class="brand">
        <div class="logo">TL</div>
        <div class="brand-text">
          <div class="title">TinyLink</div>
          <div class="subtitle">Create a short URL</div>
        </div>
      </div>

      <nav class="nav" style="margin-top:8px;">
        <a href="/dashboard" class="nav-item">Dashboard</a>
        <a href="/create" class="nav-item active">Create Link</a>
        <a href="/api/links" class="nav-item">API</a>
      </nav>

      <div class="sidebar-foot" style="margin-top:12px;">
        <div class="muted">Tip</div>
        <div style="margin-top:6px;color:var(--muted);font-size:13px;">
          You can enter a custom code (A-Z, a-z, 0-9, 6–8 chars), otherwise one will be generated.
        </div>
      </div>
    </aside>

    <main class="main" style="padding:18px;">
      <header class="topbar" style="margin-bottom:18px;">
        <div class="top-left">
          <h1 class="page-title">Create New Link</h1>
          <div class="page-sub">Shorten a URL and optionally choose a custom short code.</div>
        </div>

        <div class="top-right">
          <a href="/dashboard" class="btn small">Back to dashboard</a>
        </div>
      </header>

      <section class="panel" style="padding:18px;">
        <div class="panel-head">
          <h2 class="panel-title">Create Link</h2>
          <div class="panel-meta muted">Create a short URL that you can share</div>
        </div>

        <!-- error/success area -->
        <% if (typeof error !== 'undefined' && error) { %>
          <div style="margin:12px 0;padding:10px;border-radius:8px;background:rgba(255,60,80,0.06);border:1px solid rgba(255,60,80,0.08);color:#ffd7db;">
            <strong>Error:</strong> <%= error %>
          </div>
        <% } %>

         <form id="createForm" method="POST" action="/create" style="display:grid;gap:12px;">
         <div style="display:flex;flex-direction:column;gap:6px;">
         <label style="font-weight:700;">Destination URL</label>
         <input id="destination" type="url" name="destination" placeholder="https://example.com/path or example.com" required
           class="search-input" value="<%= values && values.destination ? values.destination : '' %>" />
         <div class="muted small">Tip: protocol is optional — we'll add <code>https://</code> if missing.</div>
         </div>

         <div style="display:flex;flex-direction:column;gap:6px;">
         <label style="font-weight:700;">Custom short code (optional)</label>
         <input id="custom" type="text" name="custom" placeholder="e.g. docs01" maxlength="8"
           class="search-input" value="<%= values && values.custom ? values.custom : '' %>"/>
         <div class="muted small">Allowed: letters and numbers, 6–8 characters recommended.</div>
         </div>

         <div style="display:flex;gap:12px;align-items:center;">
         <button id="createBtn" class="btn primary" type="submit">Create link</button>
         <button id="previewBtn" type="button" class="btn small">Preview</button>
         <div id="previewArea" class="muted small" style="margin-left:8px;"></div>
         </div>
         </form>

      </section>

     <footer class="foot">© <%= new Date().getFullYear() %> TinyLink — Built with ❤️</footer>

    </main>
  </div>

  <script>
    // Client-side validation + preview
    (function(){
      const form = document.getElementById('createForm');
      const dest = document.getElementById('destination');
      const custom = document.getElementById('custom');
      const previewBtn = document.getElementById('previewBtn');
      const previewArea = document.getElementById('previewArea');

      function normalizeUrl(u){
        if (!u) return '';
        if (!/^https?:\/\//i.test(u)) return 'https://' + u;
        return u;
      }

      previewBtn.addEventListener('click', function(){
        const url = normalizeUrl(dest.value.trim());
        if (!url) {
          previewArea.innerText = 'Enter a destination to preview.';
          return;
        }
        const code = custom.value.trim() || 'generated';
        previewArea.innerHTML = `<span style="color:var(--accent-2);font-weight:700;">/${code}</span> → ${url}`;
      });

      form.addEventListener('submit', function(e){
        const urlVal = dest.value.trim();
        if (!urlVal) {
          e.preventDefault();
          alert('Please enter a destination URL.');
          dest.focus();
          return;
        }
        // simple custom-code sanity check (if provided)
        const c = custom.value.trim();
        if (c && !/^[A-Za-z0-9]{3,20}$/.test(c)) {
          e.preventDefault();
          alert('Custom code can only contain letters and numbers (3–20 chars).');
          custom.focus();
          return;
        }
      });
    })();
  </script>
</body>
</html>
